{% extends "components/Layout/base_pages.html" %}

{% block content_pages %}

{% if messages %}
    {% for message in messages %}
        <div class="p-3 mb-4 rounded text-white {% if message.tags == 'success' %}bg-green-600{% elif message.tags == 'error' %}bg-red-600{% endif %}">
            {{ message }}
        </div>
    {% endfor %}
{% endif %}

<h1 class="text-2xl font-bold mb-4">Lista de Pacientes</h1>

<!-- Botón atrás -->
<div class="mb-4">
    <!-- Opción 1: Redirigir a lista de pacientes -->
    <a href="{% url 'lista_pacientes' %}" class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600">Atrás</a>

    <!-- Opción 2: Volver a la página anterior del navegador -->
    <!-- <a href="javascript:history.back()" class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600">Atrás</a> -->
</div>

<div x-data="{ selected: null }" class="overflow-x-auto">
    <table class="min-w-full border border-gray-300 text-left">
        <thead class="bg-gray-200">
            <tr>
                <th class="px-4 py-2 border">Nombre completo</th>
                <th class="px-4 py-2 border">RUN</th>
                <th class="px-4 py-2 border">DV</th>
                <th class="px-4 py-2 border">Edad</th>
            </tr>
        </thead>
        <tbody>
            {% for paciente in pacientes %}
                <tr x-show="selected === null || selected === {{ paciente.id }}"
                    class="hover:bg-gray-100 cursor-pointer"
                    @click="selected = selected === {{ paciente.id }} ? null : {{ paciente.id }}">
                    <td class="px-4 py-2 border">{{ paciente.nombre_completo }}</td>
                    <td class="px-4 py-2 border">{{ paciente.run }}</td>
                    <td class="px-4 py-2 border">{{ paciente.dv }}</td>
                    <td class="px-4 py-2 border">{{ paciente.edad }}</td>
                </tr>
                <tr x-show="selected === {{ paciente.id }}">
                    <td colspan="4" class="px-4 py-4 border bg-gray-50">
                        <ul class="space-y-1 text-sm">
                            <li><strong>Nacionalidad:</strong> {{ paciente.nacionalidad }}</li>
                            <li><strong>Inmigrante:</strong> {% if paciente.inmigrante %}Sí{% else %}No{% endif %}</li>
                            <li><strong>Pueblo originario:</strong> {% if paciente.pueblo_originario %}Sí{% else %}No{% endif %}</li>
                            <li><strong>Discapacidad:</strong> {% if paciente.discapacidad %}Sí{% else %}No{% endif %}</li>
                            <li><strong>Privada de libertad:</strong> {% if paciente.privada_libertad %}Sí{% else %}No{% endif %}</li>
                            <li><strong>Trans masculino:</strong> {% if paciente.trans_masculino %}Sí{% else %}No{% endif %}</li>
                            <li><strong>Creado por:</strong> {{ paciente.created_by }}</li>
                            <li><strong>Creado en:</strong> {{ paciente.created_at|date:"d/m/Y H:i" }}</li>
                            <li><strong>Actualizado en:</strong> {{ paciente.updated_at|date:"d/m/Y H:i" }}</li>
                        </ul>
                    </td>
                </tr>
            {% empty %}
                <tr>
                    <td class="px-4 py-2 border text-center" colspan="4">No hay pacientes registrados.</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Paginación -->
{% if pacientes.paginator.num_pages > 1 %}
<div class="mt-4 flex justify-center space-x-2">
    {% if pacientes.has_previous %}
        <a href="?page={{ pacientes.previous_page_number }}" class="px-3 py-1 bg-gray-300 rounded hover:bg-gray-400">Anterior</a>
    {% endif %}

    <span class="px-3 py-1 bg-gray-200 rounded">
        Página {{ pacientes.number }} de {{ pacientes.paginator.num_pages }}
    </span>

    {% if pacientes.has_next %}
        <a href="?page={{ pacientes.next_page_number }}" class="px-3 py-1 bg-gray-300 rounded hover:bg-gray-400">Siguiente</a>
    {% endif %}
</div>
{% else %}
<div class="mt-4 flex justify-center">
    <span class="px-3 py-1 bg-gray-200 rounded">
        Página 1 de 1
    </span>
</div>
{% endif %}


<script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>

{% endblock %}
